From bf71ca5849426219c9696b4012b93cad9176cdb3 Mon Sep 17 00:00:00 2001
From: Marty Jones <mj8263788@gmail.com>
Date: Thu, 6 Feb 2025 07:55:55 -0500
Subject: [PATCH] m4

---
 package/boot/uboot-rockchip/Makefile        |  26 +++
 package/firmware/linux-firmware/broadcom.mk |  41 ++++
 rk-m4                                       | 230 ++++++++++++++++++++
 target/linux/rockchip/image/armv8.mk        |  38 ++++
 4 files changed, 335 insertions(+)
 create mode 100644 rk-m4

diff --git a/package/boot/uboot-rockchip/Makefile b/package/boot/uboot-rockchip/Makefile
index 76ff54fe96..c2707ae7ff 100644
--- a/package/boot/uboot-rockchip/Makefile
+++ b/package/boot/uboot-rockchip/Makefile
@@ -124,6 +124,29 @@ define U-Boot/guangmiao-g4c-rk3399
     huake_guangmiao-g4c
 endef
 
+define U-Boot/nanopi-m4-rk3399
+  $(U-Boot/rk3399/Default)
+  NAME:=NanoPi M4
+  BUILD_DEVICES:= \
+    friendlyarm_nanopi-m4
+endef
+
+define U-Boot/nanopi-m4-2gb-rk3399
+  $(U-Boot/rk3399/Default)
+  NAME:=NanoPi M4 2GB
+  BUILD_DEVICES:= \
+    friendlyarm_nanopi-m4-2gb
+endef
+
+define U-Boot/nanopi-m4v2-rk3399
+  $(U-Boot/rk3399/Default)
+  NAME:=NanoPi m4v2
+  BUILD_DEVICES:= \
+    friendlyarm_nanopi-m4v2
+  UBOOT_DTS:=rk3399-nanopi-m4.dts
+  UBOOT_CONFIG:=roc-pc-rk3399
+endef
+
 define U-Boot/nanopc-t4-rk3399
   $(U-Boot/rk3399/Default)
   NAME:=NanoPC T4
@@ -386,6 +409,9 @@ endef
 
 UBOOT_TARGETS := \
   guangmiao-g4c-rk3399 \
+  nanopi-m4-rk3399 \
+  nanopi-m4-2gb-rk3399 \
+  nanopi-m4v2-rk3399 \
   nanopc-t4-rk3399 \
   nanopi-r4s-rk3399 \
   nanopi-r4se-rk3399 \
diff --git a/package/firmware/linux-firmware/broadcom.mk b/package/firmware/linux-firmware/broadcom.mk
index c00408b68f..096799c59e 100644
--- a/package/firmware/linux-firmware/broadcom.mk
+++ b/package/firmware/linux-firmware/broadcom.mk
@@ -194,3 +194,44 @@ define Package/bnx2x-firmware/install
 		$(1)/lib/firmware/bnx2x/
 endef
 $(eval $(call BuildPackage,bnx2x-firmware))
+
+## Broadcom NanoPi M4 firmware
+
+BRCMFMAC_4356_URL:=https://raw.githubusercontent.com/armbian/firmware/master/brcm/
+
+define Download/brcmfmac4356-sdio.bin
+  FILE:=brcmfmac4356-sdio.bin
+  URL:=$(BRCMFMAC_4356_URL)
+  HASH:=cc689fc1b39bd3d1655eff9fcfac60a3bf73fb6a45e77fdbab1e762aeeecf34e
+endef
+
+define Download/brcmfmac4356-sdio.clm_blob
+  FILE:=brcmfmac4356-sdio.clm_blob
+  URL:=$(BRCMFMAC_4356_URL)
+  HASH:=e048470d674de8865c30521138af248e5f96a9878ac73b707d834698cbf9a08a
+endef
+
+define Download/brcmfmac4356-sdio.txt
+  FILE:=brcmfmac4356-sdio.txt
+  URL:=$(BRCMFMAC_4356_URL)
+  HASH:=81efd86f47fac54596d3c614872b2997ed0079303136e4c675a8eaa1a39db120
+endef
+
+$(eval $(call Download,brcmfmac4356-sdio.bin))
+$(eval $(call Download,brcmfmac4356-sdio.clm_blob))
+$(eval $(call Download,brcmfmac4356-sdio.txt))
+
+Package/brcmfmac-firmware-4356-nanopi-m4 = $(call Package/firmware-default,Broadcom NanoPi M4 firmware)
+define Package/brcmfmac-firmware-4356-nanopi-m4/install
+	$(INSTALL_DIR) $(1)/lib/firmware/brcm
+	$(INSTALL_DATA) \
+		$(DL_DIR)/brcmfmac4356-sdio.bin \
+		$(1)/lib/firmware/brcm/brcmfmac4356-sdio.friendlyarm,nanopi-m4.bin
+	$(INSTALL_DATA) \
+		$(DL_DIR)/brcmfmac4356-sdio.clm_blob \
+		$(1)/lib/firmware/brcm/brcmfmac4356-sdio.friendlyarm,nanopi-m4.clm_blob
+	$(INSTALL_DATA) \
+		$(DL_DIR)/brcmfmac4356-sdio.txt \
+		$(1)/lib/firmware/brcm/brcmfmac4356-sdio.friendlyarm,nanopi-m4.txt
+endef
+$(eval $(call BuildPackage,brcmfmac-firmware-4356-nanopi-m4))
diff --git a/rk-m4 b/rk-m4
new file mode 100644
index 0000000000..ed2570c69f
--- /dev/null
+++ b/rk-m4
@@ -0,0 +1,230 @@
+CONFIG_TARGET_rockchip=y
+CONFIG_TARGET_rockchip_armv8=y
+CONFIG_TARGET_MULTI_PROFILE=y
+CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-m4=y
+CONFIG_TARGET_DEVICE_PACKAGES_rockchip_armv8_DEVICE_friendlyarm_nanopi-m4=""
+CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-m4-2gb=y
+CONFIG_TARGET_DEVICE_PACKAGES_rockchip_armv8_DEVICE_friendlyarm_nanopi-m4-2gb=""
+CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-m4v2=y
+CONFIG_TARGET_DEVICE_PACKAGES_rockchip_armv8_DEVICE_friendlyarm_nanopi-m4v2=""
+CONFIG_DEVEL=y
+CONFIG_TARGET_PER_DEVICE_ROOTFS=y
+CONFIG_AUTOREMOVE=y
+CONFIG_BPF_TOOLCHAIN_HOST=y
+CONFIG_BPF_TOOLCHAIN_HOST_PATH=""
+# CONFIG_BPF_TOOLCHAIN_NONE is not set
+CONFIG_HAS_BPF_TOOLCHAIN=y
+CONFIG_HTOP_LMSENSORS=y
+CONFIG_PACKAGE_blkid=y
+CONFIG_PACKAGE_blockd=y
+CONFIG_PACKAGE_btop=y
+CONFIG_PACKAGE_btrfs-progs=y
+CONFIG_PACKAGE_cgi-io=y
+CONFIG_PACKAGE_cpulimit=y
+CONFIG_PACKAGE_htop=y
+CONFIG_PACKAGE_kmod-asn1-decoder=y
+CONFIG_PACKAGE_kmod-crypto-acompress=y
+CONFIG_PACKAGE_kmod-crypto-blake2b=y
+CONFIG_PACKAGE_kmod-crypto-ccm=y
+CONFIG_PACKAGE_kmod-crypto-cmac=y
+CONFIG_PACKAGE_kmod-crypto-ctr=y
+CONFIG_PACKAGE_kmod-crypto-des=y
+CONFIG_PACKAGE_kmod-crypto-gcm=y
+CONFIG_PACKAGE_kmod-crypto-geniv=y
+CONFIG_PACKAGE_kmod-crypto-gf128=y
+CONFIG_PACKAGE_kmod-crypto-ghash=y
+CONFIG_PACKAGE_kmod-crypto-md5=y
+CONFIG_PACKAGE_kmod-crypto-seqiv=y
+CONFIG_PACKAGE_kmod-crypto-sha256=y
+CONFIG_PACKAGE_kmod-crypto-xxhash=y
+CONFIG_PACKAGE_kmod-fs-autofs4=y
+CONFIG_PACKAGE_kmod-fs-btrfs=y
+CONFIG_PACKAGE_kmod-fs-ksmbd=y
+CONFIG_PACKAGE_kmod-fs-netfs=y
+CONFIG_PACKAGE_kmod-fs-smbfs-common=y
+CONFIG_PACKAGE_kmod-lib-lzo=y
+CONFIG_PACKAGE_kmod-lib-raid6=y
+CONFIG_PACKAGE_kmod-lib-xor=y
+CONFIG_PACKAGE_kmod-lib-xxhash=y
+CONFIG_PACKAGE_kmod-lib-zlib-deflate=y
+CONFIG_PACKAGE_kmod-lib-zlib-inflate=y
+CONFIG_PACKAGE_kmod-lib-zstd=y
+CONFIG_PACKAGE_kmod-mii=y
+CONFIG_PACKAGE_kmod-nls-ucs2-utils=y
+CONFIG_PACKAGE_kmod-oid-registry=y
+CONFIG_PACKAGE_kmod-usb-net=y
+CONFIG_PACKAGE_kmod-usb-net-cdc-ether=y
+CONFIG_PACKAGE_kmod-usb-net-cdc-ncm=y
+CONFIG_PACKAGE_kmod-usb-net-rtl8152=y
+CONFIG_PACKAGE_ksmbd-server=y
+CONFIG_PACKAGE_libatomic=y
+CONFIG_PACKAGE_libattr=y
+CONFIG_PACKAGE_libcap=y
+CONFIG_PACKAGE_libevdev=y
+CONFIG_PACKAGE_libiwinfo=y
+CONFIG_PACKAGE_libiwinfo-data=y
+CONFIG_PACKAGE_libkmod=y
+CONFIG_PACKAGE_liblua=y
+CONFIG_PACKAGE_liblucihttp=y
+CONFIG_PACKAGE_liblucihttp-lua=y
+CONFIG_PACKAGE_liblucihttp-ucode=y
+CONFIG_PACKAGE_liblzo=y
+CONFIG_PACKAGE_libmount=y
+CONFIG_PACKAGE_libnl-core=y
+CONFIG_PACKAGE_libnl-genl=y
+CONFIG_PACKAGE_libparted=y
+CONFIG_PACKAGE_libpci=y
+CONFIG_PACKAGE_libreadline=y
+CONFIG_PACKAGE_libsensors=y
+CONFIG_PACKAGE_libstdcpp=y
+CONFIG_PACKAGE_libsysfs=y
+CONFIG_PACKAGE_libubus-lua=y
+CONFIG_PACKAGE_libudev-zero=y
+CONFIG_PACKAGE_libusb-1.0=y
+CONFIG_PACKAGE_libuv=y
+CONFIG_PACKAGE_libwebsockets-full=y
+CONFIG_PACKAGE_lm-sensors=y
+CONFIG_PACKAGE_lsblk=y
+CONFIG_PACKAGE_lua=y
+CONFIG_PACKAGE_luci=y
+CONFIG_PACKAGE_luci-app-commands=y
+CONFIG_PACKAGE_luci-app-cpufreq=y
+CONFIG_PACKAGE_luci-app-cpulimit=y
+CONFIG_PACKAGE_luci-app-diskman=y
+CONFIG_PACKAGE_luci-app-filemanager=y
+CONFIG_PACKAGE_luci-app-firewall=y
+CONFIG_PACKAGE_luci-app-ksmbd=y
+CONFIG_PACKAGE_luci-app-package-manager=y
+CONFIG_PACKAGE_luci-app-ttyd=y
+CONFIG_PACKAGE_luci-base=y
+CONFIG_PACKAGE_luci-lib-base=y
+CONFIG_PACKAGE_luci-lib-ip=y
+CONFIG_PACKAGE_luci-lib-jsonc=y
+CONFIG_PACKAGE_luci-lib-nixio=y
+CONFIG_PACKAGE_luci-light=y
+CONFIG_PACKAGE_luci-lua-runtime=y
+CONFIG_PACKAGE_luci-mod-admin-full=y
+CONFIG_PACKAGE_luci-mod-network=y
+CONFIG_PACKAGE_luci-mod-status=y
+CONFIG_PACKAGE_luci-mod-system=y
+CONFIG_PACKAGE_luci-proto-ipv6=y
+CONFIG_PACKAGE_luci-proto-ppp=y
+CONFIG_PACKAGE_luci-proto-relay=y
+CONFIG_PACKAGE_luci-theme-bootstrap=y
+CONFIG_PACKAGE_mount-utils=y
+CONFIG_PACKAGE_parted=y
+CONFIG_PACKAGE_pciids=y
+CONFIG_PACKAGE_pciutils=y
+CONFIG_PACKAGE_r8152-firmware=y
+CONFIG_PACKAGE_relayd=y
+CONFIG_PACKAGE_rpcd=y
+CONFIG_PACKAGE_rpcd-mod-file=y
+CONFIG_PACKAGE_rpcd-mod-iwinfo=y
+CONFIG_PACKAGE_rpcd-mod-luci=y
+CONFIG_PACKAGE_rpcd-mod-rrdns=y
+CONFIG_PACKAGE_rpcd-mod-ucode=y
+CONFIG_PACKAGE_smartmontools=y
+CONFIG_PACKAGE_sysfsutils=y
+CONFIG_PACKAGE_ttyd=y
+CONFIG_PACKAGE_ucode-mod-html=y
+CONFIG_PACKAGE_ucode-mod-lua=y
+CONFIG_PACKAGE_ucode-mod-math=y
+CONFIG_PACKAGE_uhttpd=y
+CONFIG_PACKAGE_uhttpd-mod-ubus=y
+CONFIG_PACKAGE_usbids=y
+CONFIG_PACKAGE_usbutils=y
+CONFIG_PACKAGE_wsdd2=y
+CONFIG_PARTED_READLINE=y
+CONFIG_TARGET_ALL_PROFILES=y
+CONFIG_TARGET_ROOTFS_PARTSIZE=1000
+CONFIG_USE_LLVM_HOST=y
+# CONFIG_DRIVER_11AX_SUPPORT is not set
+# CONFIG_KERNEL_PAGE_POOL is not set
+# CONFIG_PACKAGE_ath10k-board-qca9377-sdio is not set
+# CONFIG_PACKAGE_ath10k-firmware-qca9377-sdio is not set
+# CONFIG_PACKAGE_brcmfmac-firmware-43456-sdio is not set
+# CONFIG_PACKAGE_brcmfmac-firmware-4356-sdio is not set
+# CONFIG_PACKAGE_brcmfmac-firmware-43752-pcie is not set
+# CONFIG_PACKAGE_brcmfmac-firmware-43752-sdio is not set
+# CONFIG_PACKAGE_brcmfmac-nvram-43456-sdio is not set
+# CONFIG_PACKAGE_brcmfmac-nvram-4356-sdio is not set
+# CONFIG_PACKAGE_brcmfmac-nvram-43752-pcie is not set
+# CONFIG_PACKAGE_brcmfmac-nvram-43752-sdio is not set
+# CONFIG_PACKAGE_kmod-ata-ahci-dwc is not set
+# CONFIG_PACKAGE_kmod-ata-ahci-platform is not set
+# CONFIG_PACKAGE_kmod-ata-core is not set
+# CONFIG_PACKAGE_kmod-ath is not set
+# CONFIG_PACKAGE_kmod-ath10k-sdio is not set
+# CONFIG_PACKAGE_kmod-hwmon-core is not set
+# CONFIG_PACKAGE_kmod-hwmon-drivetemp is not set
+# CONFIG_PACKAGE_kmod-hwmon-pwmfan is not set
+# CONFIG_PACKAGE_kmod-libphy is not set
+# CONFIG_PACKAGE_kmod-mac80211 is not set
+# CONFIG_PACKAGE_kmod-mt7921-firmware is not set
+# CONFIG_PACKAGE_kmod-mt7921e is not set
+# CONFIG_PACKAGE_kmod-mt7922-firmware is not set
+# CONFIG_PACKAGE_kmod-r8125 is not set
+# CONFIG_PACKAGE_kmod-r8168 is not set
+# CONFIG_PACKAGE_kmod-rtw88-8723ds is not set
+# CONFIG_PACKAGE_kmod-rtw88-8723du is not set
+# CONFIG_PACKAGE_kmod-rtw88-8822ce is not set
+# CONFIG_PACKAGE_kmod-usb-net-cdc-mbim is not set
+# CONFIG_PACKAGE_kmod-usb-net-qmi-wwan is not set
+# CONFIG_PACKAGE_kmod-usb-net-rndis is not set
+# CONFIG_PACKAGE_kmod-usb-serial is not set
+# CONFIG_PACKAGE_kmod-usb-serial-option is not set
+# CONFIG_PACKAGE_kmod-usb-wdm is not set
+# CONFIG_PACKAGE_rtl8723de-firmware is not set
+# CONFIG_PACKAGE_rtl8822ce-firmware is not set
+# CONFIG_PACKAGE_trusted-firmware-a-rk3308-rock-pi-s is not set
+# CONFIG_PACKAGE_trusted-firmware-a-rk3328 is not set
+# CONFIG_PACKAGE_trusted-firmware-a-rk3566 is not set
+# CONFIG_PACKAGE_trusted-firmware-a-rk3568 is not set
+# CONFIG_PACKAGE_trusted-firmware-a-rk3568-e25 is not set
+# CONFIG_PACKAGE_trusted-firmware-a-rk3588 is not set
+# CONFIG_PACKAGE_uqmi is not set
+# CONFIG_PACKAGE_wwan is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_ariaboard_photonicat is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_armsom_sige3 is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_armsom_sige7 is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_cyber_cyber3588-aib is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_ezpro_mrkaio-m68s is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_firefly_roc-rk3328-cc is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_firefly_roc-rk3568-pc is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopc-t4 is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopc-t6 is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-r2c is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-r2c-plus is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-r2s is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-r3s is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-r4s is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-r4s-enterprise is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-r4se is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-r5c is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-r5s is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-r6c is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_friendlyarm_nanopi-r6s is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_huake_guangmiao-g4c is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_lunzn_fastrhino-r66s is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_lunzn_fastrhino-r68s is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_lyt_t68m is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_mmbox_anas3035 is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_pine64_rock64 is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_pine64_rockpro64 is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_radxa_cm3-io is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_radxa_e25 is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_radxa_rock-3a is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_radxa_rock-3b is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_radxa_rock-3c is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_radxa_rock-5a is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_radxa_rock-5b is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_radxa_rock-pi-4a is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_radxa_rock-pi-e is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_radxa_rock-pi-s is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_radxa_zero-3e is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_radxa_zero-3w is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_sinovoip_bpi-r2-pro is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_xunlong_orangepi-5 is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_xunlong_orangepi-5-plus is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_xunlong_orangepi-r1-plus is not set
+# CONFIG_TARGET_DEVICE_rockchip_armv8_DEVICE_xunlong_orangepi-r1-plus-lts is not set
diff --git a/target/linux/rockchip/image/armv8.mk b/target/linux/rockchip/image/armv8.mk
index fe4b32cdf2..7046592581 100644
--- a/target/linux/rockchip/image/armv8.mk
+++ b/target/linux/rockchip/image/armv8.mk
@@ -88,6 +88,44 @@ define Device/firefly_roc-rk3568-pc
 endef
 TARGET_DEVICES += firefly_roc-rk3568-pc
 
+define Device/friendlyarm_nanopi-m4
+  DEVICE_VENDOR := FriendlyARM
+  DEVICE_MODEL := NanoPi M4
+  SOC := rk3399
+  BOOT_FLOW := pine64-bin
+  DEVICE_PACKAGES := \
+		brcmfmac-firmware-4356-nanopi-m4 \
+		kmod-brcmfmac wpad-openssl
+endef
+TARGET_DEVICES += friendlyarm_nanopi-m4
+
+define Device/friendlyarm_nanopi-m4-2gb
+  DEVICE_VENDOR := FriendlyARM
+  DEVICE_MODEL := NanoPi M4 2GB
+  DEVICE_VARIANT := DDR3
+  SUPPORTED_DEVICES := friendlyarm,nanopi-m4
+  DEVICE_DTS := rockchip/rk3399-nanopi-m4
+  SOC := rk3399
+  BOOT_FLOW := pine64-bin
+  DEVICE_PACKAGES := \
+		brcmfmac-firmware-4356-nanopi-m4 \
+		kmod-brcmfmac wpad-openssl
+endef
+TARGET_DEVICES += friendlyarm_nanopi-m4-2gb
+
+define Device/friendlyarm_nanopi-m4v2
+  DEVICE_VENDOR := FriendlyARM
+  DEVICE_MODEL := NanoPi M4v2
+  SUPPORTED_DEVICES := friendlyarm,nanopi-m4
+  DEVICE_DTS := rockchip/rk3399-nanopi-m4
+  SOC := rk3399
+  BOOT_FLOW := pine64-bin
+  DEVICE_PACKAGES := \
+		brcmfmac-firmware-4356-nanopi-m4 \
+		kmod-brcmfmac wpad-openssl
+endef
+TARGET_DEVICES += friendlyarm_nanopi-m4v2
+
 define Device/friendlyarm_nanopc-t4
   DEVICE_VENDOR := FriendlyARM
   DEVICE_MODEL := NanoPC T4
-- 
2.46.0

